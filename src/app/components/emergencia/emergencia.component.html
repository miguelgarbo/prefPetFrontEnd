<main>

<div class="container-emergencias">
  
  <h2 class="marginTop title">Emergências</h2>
  <br>

<div *ngFor="let emergencia of emergencias" class="card mb-3 p-2 card-emergencia">
  <h4>{{ emergencia.nome }}</h4>
  <ul class="list-unstyled mb-0">
    <li *ngFor="let contato of emergencia.contatos">
      <strong>{{ contato.nomeOrgao }}</strong> - Tel: {{ contato.telefone }} - Email: {{ contato.email }}
    </li>
  </ul>
</div>
</div>

<div class="form-container d-flex gap-4 mt-4">
  <!-- Forms de adicionar amergência -->
  <div class="card p-3 flex-fill shadow-sm">
    <h3 class="mb-3">Adicionar Emergência</h3>
    <form (ngSubmit)="adicionarEmergencia()" #emergenciaForm="ngForm">

      <!-- Nome da Emergência -->
      <div class="form-group mb-3">
        <input type="text" 
               placeholder="Nome da Emergência" 
               name="nome" 
               [(ngModel)]="novaEmergencia.nome" 
               required
               class="form-control">
      </div>

      <!-- mostrar ou esconder contatos -->
      <div class="form-group mb-3">
        <button type="button" class="btn btn-secondary w-100" (click)="mostrarContatos = !mostrarContatos">
          {{ mostrarContatos ? 'Esconder Contatos' : 'Selecionar Contatos' }}
        </button>
      </div>

      <!-- Dropdown de contatos -->
      <div *ngIf="mostrarContatos" class="form-group mb-3">
        <select multiple [(ngModel)]="contatosSelecionadosIds" name="contatos" class="form-control">
          <option *ngFor="let contato of todosContatos" [value]="contato.id">
            {{ contato.nomeOrgao }} - {{ contato.telefone }}
          </option>
        </select>
      </div>

      <button type="submit" class="btn btn-primary w-100">Adicionar Emergência</button>

      <!-- botão pra excluir so pra constar, ainda não fucniona -->
      <button type="button" class="btn btn-danger w-100 mt-2">
        Excluir Emergência
      </button>
    </form>
  </div>

  <!-- Formi de Adicionar Contato -->
  <div class="card p-3 flex-fill shadow-sm">
    <h3 class="mb-3">Adicionar Contato</h3>
    <form (ngSubmit)="adicionarContato()" #contatoForm="ngForm">

      <div class="form-group mb-3">
        <input type="text" 
               placeholder="Nome do Órgão" 
               name="nomeOrgao" 
               [(ngModel)]="novoContato.nomeOrgao" 
               required
               class="form-control">
      </div>

      <div class="form-group mb-3">
        <input type="text" 
               placeholder="Telefone" 
               name="telefone" 
               [(ngModel)]="novoContato.telefone" 
               pattern="^\+?\d{10,15}$" 
               required
               class="form-control">
      </div>

      <div class="form-group mb-3">
        <input type="email" 
               placeholder="Email" 
               name="email" 
               [(ngModel)]="novoContato.email" 
               required
               class="form-control">
      </div>

      <button type="submit" class="btn btn-success w-100" [disabled]="!contatoForm.form.valid">
        Adicionar Contato
      </button>

      <!-- botão de ecluir só pra constar -->
      <button type="button" class="btn btn-danger w-100 mt-2">
        Excluir Contato
      </button>
    </form>
  </div>
</div>
</main>
